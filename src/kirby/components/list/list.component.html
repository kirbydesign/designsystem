<ion-list [ngClass]="{ 'load-on-demand' : isLoadOnDemandEnabled }">
  <ion-list-header *ngIf="listHeaderTemplate">
    <ng-container *ngTemplateOutlet="listHeaderTemplate"></ng-container>
  </ion-list-header>
  
  <ng-container *ngIf="isSectionsEnabled; else normalList">
    <ng-container *ngFor="let section of groupedItems">
        <ion-item-divider class="section-header">
          <ng-container *ngTemplateOutlet="sectionHeaderTemplate; context: { $implicit: section.name }"></ng-container>
        </ion-item-divider>

        <ion-item-divider 
          *ngFor="let item of section.items; let idx = index;" 
          [class.divider]="showDivider"
          [class.selectable]="isSelectable"
          [attr.role]="isSelectable ? 'button' : null"
          [class.last-in-section]="idx === section.items.length - 1"
          (click)="onItemSelect(item)"
          tabindex="0"
          keyHandler>
            
          <ion-item>    
            <ng-container *ngTemplateOutlet="listItemTemplate; context: { $implicit: item }"></ng-container>
            <ng-container *ngTemplateOutlet="listFlexItemTemplate; context: { $implicit: item }"></ng-container>
          </ion-item>
        </ion-item-divider>
    </ng-container>
  </ng-container>

  <ng-template #normalList>
    <ion-item-divider 
      *ngFor="let item of items" 
      [class.divider]="showDivider"
      [class.selectable]="isSelectable"
      [attr.role]="isSelectable ? 'button' : null"
      (click)="onItemSelect(item)"
      tabindex="0"
      keyHandler>       
      
      <ion-item>  
        <ng-container *ngTemplateOutlet="listItemTemplate; context: { $implicit: item }"></ng-container>
        <ng-container *ngTemplateOutlet="listFlexItemTemplate; context: { $implicit: item }"></ng-container>
      </ion-item>
    </ion-item-divider>
  </ng-template>

  <div *ngIf="listFooterTemplate" class="footer">
    <ng-container *ngTemplateOutlet="listFooterTemplate"></ng-container>
  </div>
</ion-list>

<ion-infinite-scroll kirbyInfiniteScroll (scrollEnd)="onLoadOnDemand()" [disabled]="!isLoadOnDemandEnabled">
  <ion-infinite-scroll-content>
    <kirby-spinner *ngIf="isLoading"></kirby-spinner>
    <ion-label *ngIf="showNoMoreItemsText">{{ noMoreItemsText }}</ion-label>
  </ion-infinite-scroll-content>
</ion-infinite-scroll>
