
<ion-list #list mode="ios" kirbyInfiniteScroll (scrollEnd)="onLoadOnDemand()" [disabled]="!isLoadOnDemandEnabled" (window:resize)="onResize()">
  <ion-list-header class="list-header" *ngIf="listHeaderTemplate">
    <ng-container *ngTemplateOutlet="listHeaderTemplate"></ng-container>
  </ion-list-header>
  
  <div *ngIf="isSectionsEnabled; else normalList">
    <div *ngFor="let section of groupedItems">
        <ion-list-header class="section-header">
          <ion-label class="kirby-text-small">{{ section.name }}</ion-label>
        </ion-list-header>

        <ion-item-sliding
          *ngFor="let item of section.items; let idx = index;"
          [class.last-in-section]="idx === section.items.length - 1"
          [class.divider]="showDivider"
          class="sliding-row"
          [attr.disabled]="isSwipingDisabled"> 

          <ng-container *ngTemplateOutlet="swipeActions; context: { $implicit: item }"></ng-container>

          <ion-item
            [class.last-in-section]="idx === section.items.length - 1"
            (click)="onItemSelect(item)"
            [attr.role]="isSelectable ? 'button' : null"
            [class.selectable]="isSelectable"
            tabindex="0"
            class="row"
            keyHandler>

            <ng-container *ngTemplateOutlet="listItemTemplate; context: { $implicit: item }"></ng-container>
            <ng-container *ngTemplateOutlet="listFlexItemTemplate; context: { $implicit: item }"></ng-container>
          </ion-item>

      </ion-item-sliding>
    </div>
  </div>

  <ng-template #normalList>
      <ion-item-sliding
        *ngFor="let item of items"
        [class.divider]="showDivider"
        [attr.disabled]="isSwipingDisabled">
        
        <ng-container *ngTemplateOutlet="swipeActions; context: { $implicit: item }"></ng-container>
        
        <ion-item
          (click)="onItemSelect(item)"
          [attr.role]="isSelectable ? 'button' : null"
          [class.selectable]="isSelectable"
          tabindex="0"
          class="row"
          keyHandler>
          
          <ng-container *ngTemplateOutlet="listItemTemplate; context: { $implicit: item }"></ng-container>
          <ng-container *ngTemplateOutlet="listFlexItemTemplate; context: { $implicit: item }"></ng-container>
        </ion-item>
      </ion-item-sliding>
  </ng-template>

  <ion-item *ngIf="isLoading" class="loading">
    <div class="extending">
      <kirby-spinner></kirby-spinner>
    </div>
  </ion-item>
  
  <ion-item *ngIf="!isLoadOnDemandEnabled && noMoreItemsText" class="no-more-items">
    <span class="extending">{{ noMoreItemsText }}</span>
  </ion-item>

  <ion-item *ngIf="listFooterTemplate">
    <ng-container *ngTemplateOutlet="listFooterTemplate"></ng-container>
  </ion-item>
</ion-list>

<!-- Swipe Action templates -->
<ng-template #swipeActions let-item>
  <ion-item-options *ngIf="getSwipeActionsSide('left') && getSwipeActionsSide('left').length > 0" side="start" (ionSwipe)="onActionSwipeLtR(item)">
    <ng-container *ngTemplateOutlet="swipeAction; context: { $implicit: item, swipeActions: getSwipeActionsSide('left') }"></ng-container>
  </ion-item-options>
  
  <ion-item-options  *ngIf="getSwipeActionsSide('left') && getSwipeActionsSide('left').length > 0" side="end" (ionSwipe)="onActionSwipeRtL(item)">
    <ng-container *ngTemplateOutlet="swipeAction; context: { $implicit: item, swipeActions: getSwipeActionsSide('right') }"></ng-container>
  </ion-item-options>
</ng-template>

<ng-template #swipeAction let-item let-swipeActions="swipeActions">
  <div class="swipe-action">
    <ion-item-option
        *ngFor="let swipeAction of swipeActions" 
        [ngClass]="swipeAction.themeColor"
        (click)="onSwipeActionSelect(swipeAction, item)"
        expandable>
      <div class="item-content">
        <kirby-icon *ngIf="swipeAction.iconName" [name]="getSwipeActionIconName(swipeAction, item)">
        </kirby-icon>
        <ion-label>{{ getSwipeActionTitle(swipeAction, item) }}</ion-label>
      </div>
    </ion-item-option>
  </div>
</ng-template>
