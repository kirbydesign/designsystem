<ModalStack class="modal-wrapper" android:style="padding-top: {{outerPaddingTop}};" dismissEnabled="true" (showingModally)="onShowingModally($event)">
    <StackLayout id="modal" class="modal" android:style="margin-bottom: {{innerMarginBottom}};" orientation="vertical" verticalAlignment="bottom">
        <StackLayout *ngIf="config.flavor === 'drawer'">
            <ng-container *ngTemplateOutlet="drawer"></ng-container>
        </StackLayout>
        <StackLayout *ngIf="config.flavor === 'modal'">
            <ng-container *ngTemplateOutlet="modal"></ng-container>
        </StackLayout>
    </StackLayout>
</ModalStack>

<ng-template #drawer>
    <GridLayout rows="auto, *" columns="64, *, 64" class="title-bar">
        <StackLayout row="0" col="0" class="modal-button">
            <ng-container *ngTemplateOutlet="closeIcon; context: { icon: 'arrow-down' }"></ng-container>
        </StackLayout>

        <StackLayout row="0" col="1" >
            <ng-container *ngTemplateOutlet="title; context: { horizontalAlignment: 'center' }"></ng-container>
        </StackLayout>
        
        <StackLayout row="0" col="2" class="modal-button" *ngIf="config.drawerSupplementaryAction">
            <ng-container *ngTemplateOutlet="supplementaryButton; context: { btn: config.drawerSupplementaryAction }"></ng-container>
        </StackLayout>
        
        <ScrollView height="100%" width="100%" row="1" colSpan="3">
            <ng-container *ngComponentOutlet="config.component; injector: componentPropsInjector"></ng-container>
        </ScrollView>
    </GridLayout>
</ng-template>

<ng-template #modal>
    <GridLayout rows="auto, *" columns="*, 64" class="title-bar">    
        <StackLayout row="0" col="0" >
            <ng-container *ngTemplateOutlet="title; context: { horizontalAlignment: 'left' }"></ng-container>
        </StackLayout>
        
        <StackLayout row="0" col="1" class="modal-button">
            <ng-container *ngTemplateOutlet="closeIcon; context: { icon: 'close' }"></ng-container>
        </StackLayout>

        <ScrollView height="100%" width="100%" row="1" colSpan="2">
            <ng-container *ngComponentOutlet="config.component; injector: componentPropsInjector"></ng-container>
        </ScrollView>
    </GridLayout>
</ng-template>

<ng-template #closeIcon let-icon="icon">
    <kirby-floating-action-button 
            [showShadow]="false" 
            (tap)="onModalDismiss()" 
            [isFloating]="false">
        <kirby-icon [name]="icon"></kirby-icon>
    </kirby-floating-action-button>
</ng-template>

<ng-template #supplementaryButton let-btn="btn">
    <kirby-floating-action-button
        [showShadow]="false"
        (tap)="btn.action($event)" 
        [isFloating]="false">
        <kirby-icon [name]="btn.iconName"></kirby-icon>
    </kirby-floating-action-button>
</ng-template>

<ng-template #title let-horizontalAlignment="horizontalAlignment">
    <Label class="title" 
        verticalAlignment="center" 
        [horizontalAlignment]="horizontalAlignment" 
        textWrap="true"
        text="{{ config.title }}"></Label>
</ng-template>
