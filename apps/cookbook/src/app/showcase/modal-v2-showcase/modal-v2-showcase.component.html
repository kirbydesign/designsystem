<p>
  A Modal is a dialog that appears on top of the app's content, and must be dismissed by the app
  before interaction can resume. It is useful as a select component when there are a lot of options
  to choose from, or when filtering items in a list, as well as many other use cases.
</p>

<p>
  If the modal is used on a page with scroll, then it requires that the container responsible for
  the overflow is another element than the
  <code>body</code>
  , fx.
  <code>kirby-page</code>
  or a custom container. Otherwise it will jump back to the top of the page, where the modal is
  rendered, as is evident in the showcase for the controller-based modal on this page, when pressing
  its
  <code>Open modal</code>
  button.
</p>

<p>Modals can be made by using a component or generated through the modal controller.</p>

<h3><a href="#" (click)="scrollTo(component)">Component</a></h3>

<ul>
  <li><a href="#" (click)="scrollTo(fullscreenModal)">Modal</a></li>
  <li>
    <a href="#" (click)="scrollTo(drawer)">Drawer Modal</a>

    <ul>
      <li>
        <a href="#" (click)="scrollTo(nestedModal)">Nested Modals</a>
      </li>
      <li>
        <a href="#" (click)="scrollTo(fullscreenModalSlots)">Slots</a>
      </li>
      <li>
        <a href="#" (click)="scrollTo(fullscreenModalProperties)">Properties</a>
      </li>
      <li>
        <a href="#" (click)="scrollTo(fullscreenModalEvents)">Events</a>
      </li>
      <li>
        <a href="#" (click)="scrollTo(fullscreenModalMethods)">Methods</a>
      </li>
    </ul>
  </li>

  <li>
    <a href="#" (click)="scrollTo(modalFooter)">Footer component</a>

    <ul>
      <li><a href="#" (click)="scrollTo(modalFooterProperties)">Properties</a></li>
    </ul>
  </li>
</ul>

<h3><a href="#" (click)="scrollTo(modalController)">ModalController</a></h3>

<ul>
  <li><a href="#" (click)="scrollTo(modalControllerMethods)">Methods</a></li>
  <li><a href="#" (click)="scrollTo(modalControllerConfig)">Config</a></li>
  <li>
    <a href="#" (click)="scrollTo(modalControllerSubscriptions)">
      Subscribe to
      <code>onWillDismiss</code>
      or
      <code>onDidDismiss</code>
    </a>
  </li>
  <li>
    <a href="#" (click)="scrollTo(modalControllerWrapperProperties)">Modal Wrapper Properties</a>
  </li>
</ul>

<h3><a href="#" (click)="scrollTo(routing)">Routing</a></h3>

<hr />

<h1 #component></h1>

<div class="page-example">
  <div>
    <h2 #fullscreenModal>Modal</h2>

    <p>
      The default
      <code>flavor</code>
      of the modal component. With the
      <code>modal</code>
      flavor, the dialog opens with a slide-up animation, the title is centered and the close button
      is placed in the top right corner. The modal can't be closed by swiping. If nested modals are
      opened, they will simply slide up and appear on top of the modal(s) underneath.
    </p>

    <p>
      On mobile the modal will take up the whole screen and on desktop it will appear centered on
      screen.
    </p>

    <cookbook-code-viewer [html]="fullscreenModalExampleTemplateHTML"></cookbook-code-viewer>
    <cookbook-code-viewer [ts]="fullscreenModalExampleTemplateTS"></cookbook-code-viewer>
  </div>

  <cookbook-iphone src="/examples/modal-v2/fullscreen" showExternalLink="true"></cookbook-iphone>
</div>

<div class="page-example">
  <div>
    <h2 #drawer>Drawer Modal</h2>

    <p>
      When the
      <code>drawer</code>
      flavor is used, the dialog opens with a slide-up animation, the title is centered and the
      close button is placed in the top left corner. Additionally, with the drawer flavor, users can
      use the
      <code>drawer-supplementary-action</code>
      slot, which adds an additional button in the top right corner.
    </p>

    <p>
      To create a drawer it's required to pass
      <code>flavor</code>
      ,
      <code>breakpoints</code>
      ,
      <code>initialBreakpoint</code>
      .
      <code>breakpoints</code>
      is a list of allowed breakpoints that the drawer can snap to when swiping. Each number
      describes a percentage of the screen, fx.
      <br />
      <code>[0, 0.5, 1]</code>
      allows the drawer to take up 0%, 50% and 100% of the screen.
      <code>initialBreakpoint</code>
      is the breakpoint the drawer opens at, and must match one of the values from
      <code>breakpoints</code>
      .
    </p>

    <cookbook-code-viewer [html]="drawerExampleTemplateHTML"></cookbook-code-viewer>
    <cookbook-code-viewer [ts]="drawerExampleTemplateTS"></cookbook-code-viewer>

    <h3>Convert drawer to modal</h3>

    <p>
      The drawer is not recommend to use on desktop, but there is a simple way to convert the drawer
      to a modal, using the
      <code>flavor</code>
      input like this:
    </p>

    <cookbook-code-viewer [html]="drawerToModalExampleTemplateHTML"></cookbook-code-viewer>
  </div>

  <cookbook-iphone src="/examples/modal-v2/drawer" [showExternalLink]="true"></cookbook-iphone>
</div>

<div class="page-example">
  <div>
    <h2 #nestedModal>Nested Modals</h2>

    <p>The example on the right shows how it looks when modals are nested.</p>
    <p>
      As mentioned above it is recommended to convert the drawer to a modal on desktop. It it
      achieved in this example by following the same approach as described in the section above.
    </p>

    <cookbook-example-viewer
      [html]="nestedModalsExampleTemplateHTML"
      [ts]="nestedModalsExampleTemplateTS"
    ></cookbook-example-viewer>
  </div>

  <cookbook-iphone src="/examples/modal-v2/nested" [showExternalLink]="true"></cookbook-iphone>
</div>

<h2 #fullscreenModalSlots>Slots</h2>
<p>
  The modal component accepts 4 slots:
  <code>header-start</code>
  ,
  <code>default</code>
  ,
  <code>drawer-supplementary-action</code>
  &
  <code>footer</code>
  .
</p>

<h3>header-start (only for Modal)</h3>

<p>
  The
  <code>header-start</code>
  slot places content in the upper left corner of the modal header. In the example above a
  <code>kirby-page-progress</code>
  component is slotted in like this:
</p>

<cookbook-code-viewer [html]="headerStartSlotExampleTemplate"></cookbook-code-viewer>

<h3>default</h3>

<p>
  The
  <code>default</code>
  slot places the provided markup or component in the modal's content.
</p>

<h3>drawer-supplementary-action (only for Drawer)</h3>

<p>
  The
  <code>drawer-supplementary-action</code>
  slot places content in the upper right corner of the drawer header.
</p>

<h3>footer</h3>

<p>
  The
  <code>footer</code>
  slot places content in the bottom of the modal underneath the scrollable container, so it will
  always stick to the bottom. We recommend using the
  <code>kirby-modal-v2-footer</code>
  component, which is documented right
  <a href="#" (click)="scrollTo(modalFooter)">here</a>
  . In the example above the
  <code>kirby-modal-v2-footer</code>
  component is slotted in like this:
</p>

<cookbook-code-viewer [html]="footerSlotExampleTemplate"></cookbook-code-viewer>

<div class="description">
  <h2 #fullscreenModalProperties>Modal & Drawer properties:</h2>
  <cookbook-api-description-properties
    [properties]="componentProperties"
  ></cookbook-api-description-properties>

  <h2 #fullscreenModalEvents>Events:</h2>
  <cookbook-api-description-events [events]="events"></cookbook-api-description-events>

  <h2 #fullscreenModalMethods>Methods:</h2>
  <cookbook-api-description-methods [methods]="methods"></cookbook-api-description-methods>
</div>

<h2 #modalFooter>Footer component</h2>

<p>
  The
  <code>kirby-modal-v2-footer</code>
  component only accepts a default slot as shown below:
</p>

<cookbook-code-viewer [html]="footerSlotExampleTemplate"></cookbook-code-viewer>

<h2 #modalFooterProperties>Modal footer properties:</h2>

<cookbook-api-description-properties
  [properties]="footerProperties"
></cookbook-api-description-properties>

<h1 #modalController>Controller</h1>

<p>
  Modals and Drawers can also be opened programmatically by using the
  <code>ModalV2Controller</code>
  . To show the modal, create a
  <code>ModalV2Config</code>
  and pass it to the
  <code>modalController.showModal</code>
  method:
</p>

<p>
  We recommend wrapping your component in the
  <code>kirby-modal-v2-wrapper</code>
  component to get the default Kirby styling. It accepts the same 4 slots as described above -
  <code>header-start</code>
  ,
  <code>default</code>
  ,
  <code>drawer-supplementary-action</code>
  &
  <code>footer</code>
  .
</p>

<cookbook-code-viewer [ts]="showModalCodeSnippet"></cookbook-code-viewer>

<button kirby-button (click)="openModal()">Open modal</button>
<button kirby-button (click)="openModal(true)">Open modal with canDismiss</button>

<br />

<h2 #modalControllerSubscriptions class="subscriptions">
  Subscribe to
  <code>onWillDismiss</code>
  or
  <code>onDidDismiss</code>
</h2>

<p>
  The
  <code>showModal</code>
  method returns observables for the
  <code>onWillDismiss</code>
  and
  <code>onDidDismiss</code>
  events, so it's possible to subscribe to either one or both at the same time. The subscriptions
  both return an object that contains
  <code>data</code>
  and
  <code>role</code>
  as described in the
  <code>closeModal</code>
  method described
  <a href="#" (click)="scrollTo(modalControllerMethods)">here</a>
  .
</p>

<cookbook-example-viewer [ts]="observableCodeSnippet"></cookbook-example-viewer>

<h2 #modalControllerMethods>Controller methods:</h2>

<cookbook-api-description-methods [methods]="controllerMethods"></cookbook-api-description-methods>

<h2 #modalControllerConfig>Modal config:</h2>
<cookbook-api-description-properties
  [properties]="controllerProperties"
></cookbook-api-description-properties>

<h2 #modalControllerWrapperProperties>Modal wrapper properties:</h2>

<cookbook-api-description-properties
  [properties]="wrapperComponentProperties"
></cookbook-api-description-properties>

<h1 #routing>Routing</h1>

<p>
  Instead of providing the modal with a component, you can configure your route to be opened in a
  modal. This is done by using a secondary outlet named
  <code>modal-v2</code>
  . The url for these kind of routes will look like this
  <code>/(modal-v2:some-route)</code>
  . This means that you can do flows inside of modals just as "normal" pages, and makes it possible
  to deeplink to specific pages inside of the modal. "Modal" routes will automatically open up a
  modal, if none is already opened.
</p>

<p>
  The code snippet below shows the route configuration for this page. Note that this page also
  contains a named router outlet called
  <code>modal-v2</code>
  .
</p>

<p>
  <em>
    <strong>*Please note:</strong>
    The path that has the
    <code>modal-v2</code>
    outlet must use the
    <code>ModalV2RoutingComponent</code>
    , which can be imported from Kirby.
  </em>
</p>

<cookbook-code-viewer [ts]="routerConfigCodeSnippet"></cookbook-code-viewer>

<cookbook-modal-routing-v2-example></cookbook-modal-routing-v2-example>

<cookbook-code-viewer [html]="routerLinkCodeSnippet"></cookbook-code-viewer>
<cookbook-code-viewer [ts]="programmaticRoutingCodeSnippet"></cookbook-code-viewer>

<p>
  <em>
    <strong>*Please note:</strong>
    Because of limitations with Angular Router it is not possible to close the modal from within a
    named outlet with the
    <code>routerLink</code>
    directive, and must be done programmatically like shown above. When closing the modal it must be
    relative to the parent that contains the named
    <code>router-outlet</code>
    . In the case of the modal on page 2 we need to go two levels up to close the modal, when
    pressing
    <code>Finish</code>
    , which is why we provide
    <code>this.route.parent.parent</code>
    . All logic to close the modal when clicking the backdrop or the close button in the header is
    handled by the modal itself.
  </em>
</p>
