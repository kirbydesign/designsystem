<ion-list
  #list
  #viewport
  kirbyInfiniteScroll
  (scrollEnd)="listComponent.onLoadOnDemand()"
  [disabled]="!listComponent.isLoadOnDemandEnabled"
  class="list viewport"
  [class.has-header]="listComponent.headerTemplate"
  [class.has-footer]="listComponent.footerTemplate"
  [class.has-divider]="listComponent.showDivider"
  [style.height]="listComponent.virtualScrollViewportHeight + 'px'"
>
  <ion-list-header *ngIf="listComponent.headerTemplate">
    <ng-container *ngTemplateOutlet="listComponent.headerTemplate"></ng-container>
  </ion-list-header>

  <ng-container
    *ngTemplateOutlet="
      listComponent.isSectionsEnabled ? groupedListTemplate : slidingItemsTemplate;
      context: { $implicit: listComponent.datasource }
    "
  ></ng-container>

  <div *ngIf="listComponent.footerTemplate" class="footer">
    <ng-container *ngTemplateOutlet="listComponent.footerTemplate"></ng-container>
  </div>
</ion-list>

<p
  *ngIf="!listComponent.isLoadOnDemandEnabled && listComponent.noMoreItemsText"
  class="no-more-items"
>
  {{ noMoreItemsText }}
</p>
<div *ngIf="listComponent.isLoading" class="loading">
  <kirby-spinner></kirby-spinner>
</div>

<ng-template #groupedListTemplate>
  <ion-item-group
    *ngFor="let section of listComponent.groupedItems; trackBy: listComponent.sectionTrackBy"
  >
    <ion-item-divider>
      <ng-container
        *ngTemplateOutlet="
          listComponent.sectionHeaderTemplate;
          context: { $implicit: section.name }
        "
      ></ng-container>
    </ion-item-divider>

    <div class="list-items">
      <ng-container
        *ngTemplateOutlet="slidingItemsTemplate; context: { $implicit: section.items }"
      ></ng-container>
    </div>
  </ion-item-group>
</ng-template>

<!-- Swipe Action templates -->
<ng-template #slidingItemsTemplate let-datasource>
  <div *uiScroll="let item of datasource">
    <div class="item-wrapper">
      <kirby-list-item
        [item]="item.item"
        class="list-item"
        [orderClass]="
          listComponent.getItemOrderClass(item.itemMeta.itemIndex, item.itemMeta.totalCount)
        "
      >
      </kirby-list-item>
    </div>
  </div>
</ng-template>

<!-- Swipe Action templates -->
<!-- <ng-template #slidingItemsTemplate let-items>
  <div *uiScroll="let item of datasource">
    <div class="item-wrapper">
      <ion-item-sliding
        [class.selected]="isSelectable && item === selectedItem"
        [kirbyListItemColor]="getItemColor"
        [item]="item"
        [disabled]="isSwipingEnabled ? null : true"
        keyHandler
        (click)="isSelectable ? onItemSelect(item) : null"
      >
        <ng-container
          *ngTemplateOutlet="swipeActionsTemplate; context: { $implicit: item }"
        ></ng-container>
        <ng-container
          *ngTemplateOutlet="defaultItemTemplate; context: { $implicit: item }"
        ></ng-container>
      </ion-item-sliding>
    </div>
  </div>
</ng-template> -->
