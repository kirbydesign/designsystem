<button
  kirby-button
  [size]="size"
  [attentionLevel]="attentionLevel"
  [disabled]="disabled"
  type="button"
>
  <span class="text">{{ selectedText || placeholder }}</span>
  <kirby-icon [name]="isOpen ? 'arrow-up' : 'arrow-down'"></kirby-icon>
</button>

<kirby-card
  kirbyFloating
  [strategy]="'fixed'"
  [reference]="buttonElement"
  [DOMPortalOutlet]="DOMPortalOutlet"
  class="dropdown-popover"
>
  <ng-container *ngFor="let item of items; let i = index">
    <ng-container
      *ngTemplateOutlet="
        itemTemplate || defaultItemTemplate;
        context: {
          $implicit: item,
          selected: i === selectedIndex,
          focused: i === focusedIndex,
          index: i
        }
      "
    ></ng-container>
  </ng-container>
</kirby-card>

<ng-template
  #defaultItemTemplate
  let-item
  let-selected="selected"
  let-index="index"
  let-focused="focused"
>
  <kirby-item
    [selectable]="true"
    [selected]="selected"
    (click)="onItemSelect(index)"
    [class.focused]="focused"
    role="option"
  >
    <!-- Tabindex fixes issue with popover dropdown not working in safari -->
    <h3 tabindex="0">{{ getTextFromItem(item) }}</h3>
    <kirby-icon *ngIf="selected" name="checkmark-selected" slot="end"></kirby-icon>
  </kirby-item>
</ng-template>
