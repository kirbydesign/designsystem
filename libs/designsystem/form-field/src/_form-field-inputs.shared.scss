@use '@kirbydesign/core/src/scss/utils';
@use '@kirbydesign/core/src/scss/interaction-state';

$form-field-input-font-family: var(--kirby-font-family);
$form-field-input-line-height: 1.5;
$form-field-input-padding: 1em;
$form-field-label-height: 24px;

:host(.error) {
  border: 1px solid utils.get-color('danger');
  padding: calc(
    #{$form-field-input-padding} - 1px
  ); // subtract border width from padding to maintain overall height
}

// Ensures correct position of cloned input when Ionic scrollAssist is enabled
:host(.cloned-input) {
  pointer-events: none;
  position: absolute;
  top: 0;
  left: 0;
}

// Ensures correct position of cloned input when Ionic scrollAssist is enabled
:host-context(label) {
  &.cloned-input {
    top: $form-field-label-height;
  }
}

:host {
  @include interaction-state.apply-focus-visible($shadow: utils.get-elevation(2));

  background-color: var(--kirby-inputs-background-color);
  color: var(--kirby-inputs-color);
  border: none;
  box-sizing: border-box;

  // Do not use `display: block`.
  // In Safari the input's height will be too large and the date text is not
  // properly vertically aligned.
  // The initial value is `display: inline-block` which seems to look fine, so
  // it's not necessary to declare the display property.

  font-family: $form-field-input-font-family;

  // `font-size` should be declared in `em` units but to simplify the solution
  // to https://github.com/kirbydesign/designsystem/issues/2301 we're using `rem`.
  // Must be fixed by https://github.com/kirbydesign/designsystem/issues/2313
  font-size: 1rem;
  line-height: $form-field-input-line-height;
  outline: none;
  margin: 0;
  appearance: none;
  border-radius: utils.size('s');
  box-shadow: var(--kirby-inputs-elevation);
  padding: $form-field-input-padding;
  width: 100%;

  &:host-context(kirby-item),
  &.borderless {
    border-radius: 0;
    box-shadow: none;
    padding-inline: 0;
    width: auto;
  }

  &:disabled {
    background-color: utils.get-color('light-tint');
    color: utils.get-text-color('semi-dark');
    box-shadow: none;
  }

  &::placeholder {
    color: var(--kirby-inputs-placeholder-color);
  }
}

// -----------------------------------------------------------------------------
// WARNING: Use proprietary non-standard solutions such as '::-webkit-' prefixed
// pseudo-elements with care.
// - They can stop working with any browser update
// - They are not supported by every browser - even not the major ones
// - Most of them are not on the standards track and will most likely not be
//   part of the spec any time soon if ever.

// E.g. Firefox used to support `::-webkit-calendar-picker-indicator`
// but support was removed in v109(?)

// Use `::-webkit-calendar-picker-indicator` to control the icon

// Does work in:
//  - Chrome
//  - Edge
//  - Probably other browsers as well

// Does *not* work in:
//  - Firefox >=v118 (maybe earlier versions too?)
//  - Safari >=v17 (maybe earlier versions too?)
//  - Probably other browsers as well

// See e.g. https://thenewcode.com/923/Using-The-HTML5-Date-Input
// for more examples (look for "Restrictions On Styling")
// -----------------------------------------------------------------------------

// Safari on iOS only (apparently)
// ::-webkit-date-and-time-value seems to apply with or without feature query
@supports not (selector(::-webkit-date-and-time-value)) {
  // WTF? ğŸ˜„ - Safari on iOS *does* apply this â¬‡ï¸ despite @supports not ... â¬†ï¸
  :host(input[type='date']::-webkit-date-and-time-value) {
    // Safari on iOS has less intrinsic height initially (when no date has been
    // selected yet) and when the date has been reset.
    // Declaring this min-height ensures consistent height in Safari on iOS
    min-height: #{$form-field-input-line-height + em};

    // Left align date input text in Safari on iOS
    text-align: start;
  }
}
